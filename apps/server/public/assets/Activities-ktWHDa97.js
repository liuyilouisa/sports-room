import{j as e,L as _,r as o,t as U,d as W}from"./index-BUS16Z0V.js";import{S as q,E as z,a as K}from"./Empty-BjX3nvmc.js";function $({activity:r}){const n=Math.min(r.enrolledCount/r.capacity*100,100);return e.jsxs("div",{className:"card bg-base-100 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden",children:[e.jsx("figure",{className:"w-full h-36 bg-gradient-to-br from-indigo-300 to-purple-400"}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 truncate",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:r.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["开始：",new Date(r.startAt).toLocaleString()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"已报名"}),e.jsxs("span",{children:[r.enrolledCount," / ",r.capacity]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-primary h-1.5 rounded-full",style:{width:`${n}%`}})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(_,{to:`/activities/${r.id}`,className:"btn btn-primary btn-sm w-full",children:"查看详情"})})]})]})}function B(r,n,c,h){var f=this,s=o.useRef(null),a=o.useRef(0),d=o.useRef(0),i=o.useRef(null),x=o.useRef([]),g=o.useRef(),t=o.useRef(),m=o.useRef(r),p=o.useRef(!0);m.current=r;var N=typeof window<"u",v=!n&&n!==0&&N;if(typeof r!="function")throw new TypeError("Expected a function");n=+n||0;var S=!!(c=c||{}).leading,L=!("trailing"in c)||!!c.trailing,j="maxWait"in c,P="debounceOnServer"in c&&!!c.debounceOnServer,A=j?Math.max(+c.maxWait||0,n):null;o.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var F=o.useMemo(function(){var R=function(l){var u=x.current,y=g.current;return x.current=g.current=null,a.current=l,d.current=d.current||l,t.current=m.current.apply(y,u)},w=function(l,u){v&&cancelAnimationFrame(i.current),i.current=v?requestAnimationFrame(l):setTimeout(l,u)},k=function(l){if(!p.current)return!1;var u=l-s.current;return!s.current||u>=n||u<0||j&&l-a.current>=A},D=function(l){return i.current=null,L&&x.current?R(l):(x.current=g.current=null,t.current)},E=function l(){var u=Date.now();if(S&&d.current===a.current&&M(),k(u))return D(u);if(p.current){var y=n-(u-s.current),T=j?Math.min(y,A-(u-a.current)):y;w(l,T)}},M=function(){},b=function(){if(N||P){var l=Date.now(),u=k(l);if(x.current=[].slice.call(arguments),g.current=f,s.current=l,u){if(!i.current&&p.current)return a.current=s.current,w(E,n),S?R(s.current):t.current;if(j)return w(E,n),R(s.current)}return i.current||w(E,n),t.current}};return b.cancel=function(){i.current&&(v?cancelAnimationFrame(i.current):clearTimeout(i.current)),a.current=0,x.current=s.current=g.current=i.current=null},b.isPending=function(){return!!i.current},b.flush=function(){return i.current?D(Date.now()):t.current},b},[S,j,n,A,L,v,N,P,h]);return F}function O({keyword:r,sort:n,onChange:c}){const[h,f]=o.useState(r),s=B(a=>{const d=new URLSearchParams({sort:n});a.trim()&&d.set("keyword",a.trim()),d.set("page","1"),c(d)},300);return o.useEffect(()=>f(r),[r]),e.jsxs("div",{className:"flex items-center gap-3 p-1 rounded-full bg-base-100/80 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5 ml-3 shrink-0 text-base-content/60",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"搜索活动",value:h,onChange:a=>{f(a.target.value),s(a.target.value)},className:"input input-ghost input-sm w-full max-w-xs focus:outline-none"}),e.jsx("div",{className:"h-5 w-px bg-base-300"}),e.jsxs("select",{value:n,onChange:a=>{const d=new URLSearchParams({keyword:r,sort:a.target.value});d.set("page","1"),c(d)},className:"select select-ghost select-sm focus:outline-none",children:[e.jsx("option",{value:"createdAt_DESC",children:"最新发布"}),e.jsx("option",{value:"startAt_ASC",children:"时间升序"})]}),e.jsx("div",{className:"w-2"})]})}const C=12;function Q(){const[r,n]=U(),c=r.get("keyword")||"",h=Number(r.get("page")||1),f=r.get("sort")||"createdAt_DESC",{data:s,isLoading:a,isError:d,error:i}=W({queryKey:["activities",{keyword:c,page:h,size:C,sort:f}],queryFn:()=>K({keyword:c,page:h,size:C,sort:f}),placeholderData:t=>t}),x=s?Math.ceil(s.total/C):0,g=t=>{const m=new URLSearchParams(r);m.set("page",String(t)),n(m,{replace:!0})};return a?e.jsx(q,{}):d?e.jsx("div",{className:"text-red-500 text-center py-10",children:i.message}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-10",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 tracking-tight",children:"活动列表"}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(O,{keyword:c,sort:f,onChange:t=>{const m=new URLSearchParams(t);m.set("page","1"),n(m,{replace:!0})}})})]}),!s?.data.length&&e.jsx(z,{text:"暂无活动"}),s?.data.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6 sm:gap-7 mt-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:s.data.map(t=>e.jsx($,{activity:t},t.id))}),x>1&&e.jsx("nav",{className:"flex justify-center mt-12 space-x-1",children:Array.from({length:x},(t,m)=>m+1).map(t=>e.jsx("button",{onClick:()=>g(t),className:`btn btn-sm rounded-md transition-all duration-200
                    ${t===h?"btn-primary shadow-md":"btn-ghost hover:bg-gray-200"}`,children:t},t))})]}):null]})}export{Q as default};
